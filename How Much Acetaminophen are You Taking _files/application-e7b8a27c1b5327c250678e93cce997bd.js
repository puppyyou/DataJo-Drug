propublica.models.doseMeter=propublica.Model.extend({setNum:function(e){this.curNum=e}});var doseMeter=new propublica.models.doseMeter;propublica.models.drugLabel=propublica.Model.extend({findTy:function(e){if(_.isArray(e.active_ingredients))return{type:"single",data:_(e.active_ingredients).select(function(e){return"ACETAMINOPHEN"===e.ingredientSubstance.name.toUpperCase()})};var t=_(e.active_ingredients).map(function(e,t){var a=_(e).select(function(e){return"ACETAMINOPHEN"===e.ingredientSubstance.name.toUpperCase()});if(a.length>0){var o=a[0];return o.name=t,o}return{name:t}});return{type:"multi",data:t}},cardGradient:function(e){if(!e)return"#f9f9f9";var t=parseInt(e.quantity.numerator.value,10);return t>800?"#de9696":t>400?"#e7b1b1":t>80?"#eec9c9":t>0?"#f4dcdc":void 0}});var DrugLabel=new propublica.models.drugLabel;propublica.views.overdoseOMeter=propublica.View.extend({tag:"",cssClass:"overdose_chart_item",bindings:{click:"calculateDose",mouseenter:"showOverlay",mouseleave:"hideOverlay"},calculateDose:function(e){if($(window).width()>768){var t=$(e.currentTarget),a=$(".total_box .total span"),o=doseMeter.curNum||0,s=parseInt(t.attr("data-num")),r=t.index(),i=t.children(".h4").text(),d=$(".quantity");$(".total_box .total").fadeIn("fast"),$(".total_box .no_total").hide(),this.el.removeClass("nohover"),t.hasClass("selected")?(t.removeClass("selected"),t.addClass("nohover")):t.addClass("selected");var n=function(e){return _.isNumber(e)?e.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""};doseMeter.setNum(Math.round(o)+Math.round(s)),a.text(doseMeter.curNum),parseInt(doseMeter.curNum),t.hasClass("selected")?$(".indv").prepend("<div style='height:"+Math.round(s/34.88)+"px' class='idx-"+r+"'><span class='tick_mark'></span><span class='indv_name'>"+i+" </span> <span class='indv_dose'>"+s+" mg</span></div>"):($(".idx-"+r).remove(),doseMeter.setNum(o-s),a.text(doseMeter.curNum),doseMeter.curNum<15e3&&$(".deadyet").html("")),$(".indv").position().top<0?$(".idx-"+r).hide():$(".indv div").show(),doseMeter.curNum/34.88<16e3&&d.css("height",doseMeter.curNum/34.88+"px");var l=doseMeter.curNum;4e3==l?(a.removeClass(),a.addClass("daily_max"),$(".deadyet").html("You've reached the FDA&#8217;s recommended maximum daily limit of acetaminophen."),$("#overdose_chart div").css("pointer-events","all")):l>4e3&&8e3>l?(a.removeClass(),a.addClass("daily_max"),$(".deadyet").html("You've exceeded the FDA&#8217;s recommended maximum daily limit of acetaminophen."),$("#overdose_chart div").css("pointer-events","all")):8e3==l?(a.removeClass(),a.addClass("double_max"),$(".deadyet").html("You've reached the amount at which liver damage can occur if taken for several days, according to McNeil, the maker of Tylenol."),$("#overdose_chart div").css("pointer-events","all")):l>=8e3&&15e3>l?(a.removeClass(),a.addClass("double_max"),$(".deadyet").html("You've exceeded the level at which liver damage can occur if taken for several days, according to McNeil, the maker of Tylenol."),$("#overdose_chart div").css("pointer-events","all")):15e3==l?(a.removeClass(),a.addClass("dead"),$(".deadyet").html("You've reached the threshold toxic dose of acetaminophen. A single dose at this level can result in death, according to medical experts and literature."),$("#overdose_chart div").css("pointer-events","all")):l>15e3?(a.removeClass(),a.addClass("dead"),$("#overdose_chart div").not(".selected").css("pointer-events","none"),$(".deadyet").html("You've exceeded the threshold toxic dose of acetaminophen. A single dose at this level can result in death, according to medical experts and literature.")):4e3>l&&l>0?(a.removeClass(),$(".deadyet").html(""),$("#overdose_chart div").css("pointer-events","all")):0==l&&(a.removeClass(),$(".deadyet").html(""),$(".total_box .total").hide(),$(".total_box .no_total").fadeIn("fast"),$("#overdose_chart div").css("pointer-events","all")),a.text(n(doseMeter.curNum))}},showOverlay:function(e){$("#overdose_chart div").removeClass("nohover");var t=$(e.currentTarget);t.addClass("hover")},hideOverlay:function(){$("#overdose_chart div").removeClass("hover")}}),propublica.views.drugLabelZoom=propublica.View.extend({cssClass:"drug_label_popout",bindings:{click:"popout"},render:function(){_.bindAll(this,"popout","newWindow")},popout:function(e){e.preventDefault();var t=$(e.currentTarget);return this.newWindow(t.attr("data-img-url"))},newWindow:function(e){feats="status=1;menubar=false",window.open(e,"Dark Money Stories Ads",feats),window.focus()}}),propublica.views.labelImageZoom=propublica.views.drugLabelZoom.extend({cssClass:"drug_label"}),propublica.views.drugSearch=propublica.View.extend({tag:"form",id:"drug_search",bindings:{submit:"doSearch"},render:function(){_.bindAll(this,"doSearch"),this.tmpl=_.template($("#tmpl").html()),this.container=$("#drug_result"),this.flash=$("#flash"),this.container.isotope({layoutMode:"fitRows",itemSelector:".drug_result",sortBy:"ty_ct",sortAscending:!1,getSortData:{ty_ct:function(e){return parseInt(e.attr("data-ty-ct"),10)}}})},doSearch:function(e){e.preventDefault();var t=this;this.flash.empty(),this.container.empty().isotope("reloadItems").isotope();var a=$("#search_val").val();"Tylenol"!==a&&window._gaq&&_gaq.push(["_trackPageview",RAILS_ROOT+"search?q="+a]);var o="";$.get(RAILS_ROOT+"search",{q:a},function(e){if(window.curResp=e,0===e.length)return t.flash.html("<div id='no_results'><p>No matching results. Try another search.</p></div>"),void 0;for(i=0;i<e.length;i++)o+=t.tmpl({drug:e[i]});$(o).imagesLoaded(function(){t.container.isotope("insert",$(o))})})}}),propublica.views.socialSection=propublica.View.extend({cssClass:"ss-fb",tag:"span",bindings:{click:"fb"},INTRO:"How Much Acetaminophen Are You Taking?",fb:function(){FB.ui({method:"feed",link:"http://projects.propublica.org/drug-labels",picture:"http://propublica.s3.amazonaws.com/projects/projectx/facebook_graphics/fb_druglookup.jpg",name:this.INTRO,caption:"Look up your Over the Counter drugs",description:""},function(){})}}),propublica.views.topNav=propublica.View.extend({cssClass:"top_nav_fixie",render:function(){_.bindAll(this,"stick"),this.jWindow=$(window),this.jFooter=$("footer"),this.offsetTop=this.el.offset().top,this.elHeight=this.el.height(),this.jWindow.scroll(this.stick),this.bottomOffset=400},stick:function(){if(!($(window).width()<480)){var e=this.jWindow.scrollTop();this.jFooter.offset().top,e>this.offsetTop?this.el.addClass("fixed"):this.el.removeClass("fixed")}}});